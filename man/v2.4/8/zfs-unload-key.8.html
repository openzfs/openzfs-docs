

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>zfs-unload-key.8 &mdash; OpenZFS  documentation</title>
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/mandoc.css" type="text/css" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="zfs-unmount.8" href="zfs-unmount.8.html" />
    <link rel="prev" title="zfs-unjail.8" href="zfs-unjail.8.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #29667e" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/logo_main.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Getting%20Started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Project%20and%20Community/index.html">Project and Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Developer%20Resources/index.html">Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Performance%20and%20Tuning/index.html">Performance and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Basic%20Concepts/index.html">Basic Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Man Pages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../master/index.html">master</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">v2.4</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../1/index.html">User Commands (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../4/index.html">Devices and Special Files (4)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../5/index.html">File Formats and Conventions (5)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../7/index.html">Miscellaneous (7)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">System Administration Commands (8)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="fsck.zfs.8.html">fsck.zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="mount.zfs.8.html">mount.zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="vdev_id.8.html">vdev_id.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zdb.8.html">zdb.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zed.8.html">zed.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-allow.8.html">zfs-allow.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-bookmark.8.html">zfs-bookmark.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-change-key.8.html">zfs-change-key.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-clone.8.html">zfs-clone.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-create.8.html">zfs-create.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-destroy.8.html">zfs-destroy.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-diff.8.html">zfs-diff.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-get.8.html">zfs-get.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-groupspace.8.html">zfs-groupspace.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-hold.8.html">zfs-hold.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-inherit.8.html">zfs-inherit.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-jail.8.html">zfs-jail.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-list.8.html">zfs-list.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-load-key.8.html">zfs-load-key.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-mount-generator.8.html">zfs-mount-generator.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-mount.8.html">zfs-mount.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-program.8.html">zfs-program.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-project.8.html">zfs-project.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-projectspace.8.html">zfs-projectspace.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-promote.8.html">zfs-promote.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-receive.8.html">zfs-receive.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-recv.8.html">zfs-recv.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-redact.8.html">zfs-redact.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-release.8.html">zfs-release.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-rename.8.html">zfs-rename.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-rewrite.8.html">zfs-rewrite.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-rollback.8.html">zfs-rollback.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-send.8.html">zfs-send.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-set.8.html">zfs-set.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-share.8.html">zfs-share.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-snapshot.8.html">zfs-snapshot.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unallow.8.html">zfs-unallow.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unjail.8.html">zfs-unjail.8</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">zfs-unload-key.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unmount.8.html">zfs-unmount.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unzone.8.html">zfs-unzone.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-upgrade.8.html">zfs-upgrade.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-userspace.8.html">zfs-userspace.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-wait.8.html">zfs-wait.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-zone.8.html">zfs-zone.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs.8.html">zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs_ids_to_path.8.html">zfs_ids_to_path.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs_prepare_disk.8.html">zfs_prepare_disk.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zgenhostid.8.html">zgenhostid.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zinject.8.html">zinject.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-add.8.html">zpool-add.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-attach.8.html">zpool-attach.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-checkpoint.8.html">zpool-checkpoint.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-clear.8.html">zpool-clear.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-create.8.html">zpool-create.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-ddtprune.8.html">zpool-ddtprune.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-destroy.8.html">zpool-destroy.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-detach.8.html">zpool-detach.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-events.8.html">zpool-events.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-export.8.html">zpool-export.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-get.8.html">zpool-get.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-history.8.html">zpool-history.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-import.8.html">zpool-import.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-initialize.8.html">zpool-initialize.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-iostat.8.html">zpool-iostat.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-labelclear.8.html">zpool-labelclear.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-list.8.html">zpool-list.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-offline.8.html">zpool-offline.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-online.8.html">zpool-online.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-prefetch.8.html">zpool-prefetch.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-reguid.8.html">zpool-reguid.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-remove.8.html">zpool-remove.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-reopen.8.html">zpool-reopen.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-replace.8.html">zpool-replace.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-resilver.8.html">zpool-resilver.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-scrub.8.html">zpool-scrub.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-set.8.html">zpool-set.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-split.8.html">zpool-split.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-status.8.html">zpool-status.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-sync.8.html">zpool-sync.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-trim.8.html">zpool-trim.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-upgrade.8.html">zpool-upgrade.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-wait.8.html">zpool-wait.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool.8.html">zpool.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool_influxdb.8.html">zpool_influxdb.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zstream.8.html">zstream.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zstreamdump.8.html">zstreamdump.8</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.3/index.html">v2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.2/index.html">v2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.1/index.html">v2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.0/index.html">v2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v0.8/index.html">v0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v0.7/index.html">v0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v0.6/index.html">v0.6</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../msg/index.html">ZFS Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../License.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #29667e" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OpenZFS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Man Pages</a></li>
          <li class="breadcrumb-item"><a href="../index.html">v2.4</a></li>
          <li class="breadcrumb-item"><a href="index.html">System Administration Commands (8)</a></li>
      <li class="breadcrumb-item active">zfs-unload-key.8</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/openzfs/zfs/blob/zfs-2.4.99/man/man8/zfs-unload-key.8" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="zfs-unload-key-8">
<h1>zfs-unload-key.8<a class="headerlink" href="#zfs-unload-key-8" title="Permalink to this heading"></a></h1>
<div class="man_container"><table class="head">
  <tr>
    <td class="head-ltitle">ZFS-LOAD-KEY(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">ZFS-LOAD-KEY(8)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">zfs-load-key</code> &#x2014;
    <span class="Nd">load, unload, or change encryption key of ZFS
    dataset</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">zfs</code></td>
    <td><code class="Cm">load-key</code> [<code class="Fl">-nr</code>]
      [<code class="Fl">-L</code> <var class="Ar">keylocation</var>]
      <code class="Fl">-a</code>|<var class="Ar">filesystem</var></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">zfs</code></td>
    <td><code class="Cm">unload-key</code> [<code class="Fl">-r</code>]
      <code class="Fl">-a</code>|<var class="Ar">filesystem</var></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">zfs</code></td>
    <td><code class="Cm">change-key</code> [<code class="Fl">-l</code>]
      [<code class="Fl">-o</code>
      <var class="Ar">keylocation</var>=<var class="Ar">value</var>]
      [<code class="Fl">-o</code>
      <var class="Ar">keyformat</var>=<var class="Ar">value</var>]
      [<code class="Fl">-o</code>
      <var class="Ar">pbkdf2iters</var>=<var class="Ar">value</var>]
      <var class="Ar">filesystem</var></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">zfs</code></td>
    <td><code class="Cm">change-key</code> <code class="Fl">-i</code>
      [<code class="Fl">-l</code>] <var class="Ar">filesystem</var></td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<dl class="Bl-tag">
  <dt id="available"><code class="Nm">zfs</code>
    <code class="Cm">load-key</code> [<code class="Fl">-nr</code>]
    [<code class="Fl">-L</code> <var class="Ar">keylocation</var>]
    <code class="Fl">-a</code>|<var class="Ar">filesystem</var></dt>
  <dd>Load the key for <var class="Ar">filesystem</var>, allowing it and all
      children that inherit the <b class="Sy">keylocation</b> property to be
      accessed. The key will be expected in the format specified by the
      <b class="Sy">keyformat</b> and location specified by the
      <b class="Sy">keylocation</b> property. Note that if the
      <b class="Sy">keylocation</b> is set to <b class="Sy">prompt</b> the
      terminal will interactively wait for the key to be entered. Loading a key
      will not automatically mount the dataset. If that functionality is
      desired, <code class="Nm">zfs</code> <code class="Cm">mount</code>
      <code class="Fl">-l</code> will ask for the key and mount the dataset (see
      <a href="../8/zfs-mount.8.html" class="Xr">zfs-mount(8)</a>). Once the key is loaded the
      <b class="Sy">keystatus</b> property will become
      <a class="permalink" href="#available"><b class="Sy">available</b></a>.
    <dl class="Bl-tag">
      <dt id="r"><a class="permalink" href="#r"><code class="Fl">-r</code></a></dt>
      <dd>Recursively loads the keys for the specified filesystem and all
          descendent encryption roots.</dd>
      <dt id="a"><a class="permalink" href="#a"><code class="Fl">-a</code></a></dt>
      <dd>Loads the keys for all encryption roots in all imported pools.</dd>
      <dt id="n"><a class="permalink" href="#n"><code class="Fl">-n</code></a></dt>
      <dd>Do a dry-run (&quot;No-op&quot;) <code class="Cm">load-key</code>.
          This will cause <code class="Nm">zfs</code> to simply check that the
          provided key is correct. This command may be run even if the key is
          already loaded.</dd>
      <dt id="L"><a class="permalink" href="#L"><code class="Fl">-L</code></a>
        <var class="Ar">keylocation</var></dt>
      <dd>Use <var class="Ar">keylocation</var> instead of the
          <b class="Sy">keylocation</b> property. This will not change the value
          of the property on the dataset. Note that if used with either
          <code class="Fl">-r</code> or <code class="Fl">-a</code>,
          <var class="Ar">keylocation</var> may only be given as
          <b class="Sy">prompt</b>.</dd>
    </dl>
  </dd>
  <dt id="unavailable"><code class="Nm">zfs</code>
    <code class="Cm">unload-key</code> [<code class="Fl">-r</code>]
    <code class="Fl">-a</code>|<var class="Ar">filesystem</var></dt>
  <dd>Unloads a key from ZFS, removing the ability to access the dataset and all
      of its children that inherit the <b class="Sy">keylocation</b> property.
      This requires that the dataset is not currently open or mounted. Once the
      key is unloaded the <b class="Sy">keystatus</b> property will become
      <a class="permalink" href="#unavailable"><b class="Sy">unavailable</b></a>.
    <dl class="Bl-tag">
      <dt id="r~2"><a class="permalink" href="#r~2"><code class="Fl">-r</code></a></dt>
      <dd>Recursively unloads the keys for the specified filesystem and all
          descendent encryption roots.</dd>
      <dt id="a~2"><a class="permalink" href="#a~2"><code class="Fl">-a</code></a></dt>
      <dd>Unloads the keys for all encryption roots in all imported pools.</dd>
    </dl>
  </dd>
  <dt><code class="Nm">zfs</code> <code class="Cm">change-key</code>
    [<code class="Fl">-l</code>] [<code class="Fl">-o</code>
    <var class="Ar">keylocation</var>=<var class="Ar">value</var>]
    [<code class="Fl">-o</code>
    <var class="Ar">keyformat</var>=<var class="Ar">value</var>]
    [<code class="Fl">-o</code>
    <var class="Ar">pbkdf2iters</var>=<var class="Ar">value</var>]
    <var class="Ar">filesystem</var></dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt><code class="Nm">zfs</code> <code class="Cm">change-key</code>
    <code class="Fl">-i</code> [<code class="Fl">-l</code>]
    <var class="Ar">filesystem</var></dt>
  <dd>Changes the user's key (e.g. a passphrase) used to access a dataset. This
      command requires that the existing key for the dataset is already loaded.
      This command may also be used to change the <b class="Sy">keylocation</b>,
      <b class="Sy">keyformat</b>, and <b class="Sy">pbkdf2iters</b> properties
      as needed. If the dataset was not previously an encryption root it will
      become one. Alternatively, the <code class="Fl">-i</code> flag may be
      provided to cause an encryption root to inherit the parent's key instead.
    <p class="Pp">If the user's key is compromised, <code class="Nm">zfs</code>
        <code class="Cm">change-key</code> does not necessarily protect existing
        or newly-written data from attack. Newly-written data will continue to
        be encrypted with the same master key as the existing data. The master
        key is compromised if an attacker obtains a user key and the
        corresponding wrapped master key. Currently, <code class="Nm">zfs</code>
        <code class="Cm">change-key</code> does not overwrite the previous
        wrapped master key on disk, so it is accessible via forensic analysis
        for an indeterminate length of time.</p>
    <p class="Pp">In the event of a master key compromise, ideally the drives
        should be securely erased to remove all the old data (which is readable
        using the compromised master key), a new pool created, and the data
        copied back. This can be approximated in place by creating new datasets,
        copying the data (e.g. using <code class="Nm">zfs</code>
        <code class="Cm">send</code> | <code class="Nm">zfs</code>
        <code class="Cm">recv</code>), and then clearing the free space with
        <code class="Nm">zpool</code> <code class="Cm">trim</code>
        <code class="Fl">--secure</code> if supported by your hardware,
        otherwise <code class="Nm">zpool</code>
        <code class="Cm">initialize</code>.</p>
    <dl class="Bl-tag">
      <dt id="l"><a class="permalink" href="#l"><code class="Fl">-l</code></a></dt>
      <dd>Ensures the key is loaded before attempting to change the key. This is
          effectively equivalent to running <code class="Nm">zfs</code>
          <code class="Cm">load-key</code> <var class="Ar">filesystem</var>;
          <code class="Nm">zfs</code> <code class="Cm">change-key</code>
          <var class="Ar">filesystem</var></dd>
      <dt id="o"><a class="permalink" href="#o"><code class="Fl">-o</code></a>
        <var class="Ar">property</var>=<var class="Ar">value</var></dt>
      <dd>Allows the user to set encryption key properties
          (<b class="Sy">keyformat</b>, <b class="Sy">keylocation</b>,
          <span class="No">and</span> <b class="Sy">pbkdf2iters</b>) while
          changing the key. This is the only way to alter
          <b class="Sy">keyformat</b> and <b class="Sy">pbkdf2iters</b> after
          the dataset has been created.</dd>
      <dt id="i"><a class="permalink" href="#i"><code class="Fl">-i</code></a></dt>
      <dd>Indicates that zfs should make <var class="Ar">filesystem</var>
          inherit the key of its parent. Note that this command can only be run
          on an encryption root that has an encrypted parent.</dd>
    </dl>
  </dd>
</dl>
<section class="Ss">
<h2 class="Ss" id="Encryption"><a class="permalink" href="#Encryption">Encryption</a></h2>
<p class="Pp">Enabling the <b class="Sy">encryption</b> feature allows for the
    creation of encrypted filesystems and volumes. ZFS will encrypt file and
    volume data, file attributes, ACLs, permission bits, directory listings,
    FUID mappings, and
    <a class="permalink" href="#userused"><b class="Sy" id="userused">userused</b></a>/<a class="permalink" href="#groupused"><b class="Sy" id="groupused">groupused</b></a>
    data. ZFS will not encrypt metadata related to the pool structure, including
    dataset and snapshot names, dataset hierarchy, properties, file size, file
    holes, and deduplication tables (though the deduplicated data itself is
    encrypted).</p>
<p class="Pp">Key rotation is managed by ZFS. Changing the user's key (e.g. a
    passphrase) does not require re-encrypting the entire dataset. Datasets can
    be scrubbed, resilvered, renamed, and deleted without the encryption keys
    being loaded (see the <code class="Cm">load-key</code> subcommand for more
    info on key loading).</p>
<p class="Pp" id="encryptionroot">Creating an encrypted dataset requires
    specifying the <b class="Sy">encryption</b> <span class="No">and</span>
    <b class="Sy">keyformat</b> properties at creation time, along with an
    optional <b class="Sy">keylocation</b> <span class="No">and</span>
    <b class="Sy">pbkdf2iters</b>. After entering an encryption key, the created
    dataset will become an encryption root. Any descendant datasets will inherit
    their encryption key from the encryption root by default, meaning that
    loading, unloading, or changing the key for the encryption root will
    implicitly do the same for all inheriting datasets. If this inheritance is
    not desired, simply supply a <b class="Sy">keyformat</b> when creating the
    child dataset or use <code class="Nm">zfs</code>
    <code class="Cm">change-key</code> to break an existing relationship,
    creating a new encryption root on the child. Note that the child's
    <b class="Sy">keyformat</b> may match that of the parent while still
    creating a new encryption root, and that changing the
    <b class="Sy">encryption</b> property alone does not create a new encryption
    root; this would simply use a different cipher suite with the same key as
    its encryption root. The one exception is that clones will always use their
    origin's encryption key. As a result of this exception, some
    encryption-related properties (namely <b class="Sy">keystatus</b>,
    <b class="Sy">keyformat</b>, <b class="Sy">keylocation</b>,
    <span class="No">and</span> <b class="Sy">pbkdf2iters</b>) do not inherit
    like other ZFS properties and instead use the value determined by their
    encryption root. Encryption root inheritance can be tracked via the
    read-only
    <a class="permalink" href="#encryptionroot"><b class="Sy">encryptionroot</b></a>
    property.</p>
<p class="Pp">Encryption changes the behavior of a few ZFS operations.
    Encryption is applied after compression so compression ratios are preserved.
    Normally checksums in ZFS are 256 bits long, but for encrypted data the
    checksum is 128 bits of the user-chosen checksum and 128 bits of MAC from
    the encryption suite, which provides additional protection against
    maliciously altered data. Deduplication is still possible with encryption
    enabled but for security, datasets will only deduplicate against themselves,
    their snapshots, and their clones.</p>
<p class="Pp" id="embedded_data">There are a few limitations on encrypted
    datasets. Encrypted data cannot be embedded via the
    <a class="permalink" href="#embedded_data"><b class="Sy">embedded_data</b></a>
    feature. Encrypted datasets may not have
    <a class="permalink" href="#copies"><b class="Sy" id="copies">copies</b></a>=<a class="permalink" href="#3"><i class="Em" id="3">3</i></a>
    since the implementation stores some encryption metadata where the third
    copy would normally be. Since compression is applied before encryption,
    datasets may be vulnerable to a CRIME-like attack if applications accessing
    the data allow for it. Deduplication with encryption will leak information
    about which blocks are equivalent in a dataset and will incur an extra CPU
    cost for each block written.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a href="../7/zfsprops.7.html" class="Xr">zfsprops(7)</a>, <a href="../8/zfs-create.8.html" class="Xr">zfs-create(8)</a>,
    <a href="../8/zfs-set.8.html" class="Xr">zfs-set(8)</a></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">January 13, 2020</td>
    <td class="foot-os">Debian</td>
  </tr>
</table>
</div></section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="zfs-unjail.8.html" class="btn btn-neutral float-left" title="zfs-unjail.8" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="zfs-unmount.8.html" class="btn btn-neutral float-right" title="zfs-unmount.8" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, OpenZFS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>