

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>zfs-program.8 &mdash; OpenZFS  documentation</title>
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/mandoc.css" type="text/css" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="zfs-project.8" href="zfs-project.8.html" />
    <link rel="prev" title="zfs-mount.8" href="zfs-mount.8.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #29667e" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/logo_main.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Getting%20Started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Project%20and%20Community/index.html">Project and Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Developer%20Resources/index.html">Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Performance%20and%20Tuning/index.html">Performance and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Basic%20Concepts/index.html">Basic Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Man Pages</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">master</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../1/index.html">User Commands (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../4/index.html">Devices and Special Files (4)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../5/index.html">File Formats and Conventions (5)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../7/index.html">Miscellaneous (7)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">System Administration Commands (8)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="fsck.zfs.8.html">fsck.zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="mount.zfs.8.html">mount.zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="vdev_id.8.html">vdev_id.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zdb.8.html">zdb.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zed.8.html">zed.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-allow.8.html">zfs-allow.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-bookmark.8.html">zfs-bookmark.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-change-key.8.html">zfs-change-key.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-clone.8.html">zfs-clone.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-create.8.html">zfs-create.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-destroy.8.html">zfs-destroy.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-diff.8.html">zfs-diff.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-get.8.html">zfs-get.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-groupspace.8.html">zfs-groupspace.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-hold.8.html">zfs-hold.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-inherit.8.html">zfs-inherit.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-jail.8.html">zfs-jail.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-list.8.html">zfs-list.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-load-key.8.html">zfs-load-key.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-mount-generator.8.html">zfs-mount-generator.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-mount.8.html">zfs-mount.8</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">zfs-program.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-project.8.html">zfs-project.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-projectspace.8.html">zfs-projectspace.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-promote.8.html">zfs-promote.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-receive.8.html">zfs-receive.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-recv.8.html">zfs-recv.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-redact.8.html">zfs-redact.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-release.8.html">zfs-release.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-rename.8.html">zfs-rename.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-rewrite.8.html">zfs-rewrite.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-rollback.8.html">zfs-rollback.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-send.8.html">zfs-send.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-set.8.html">zfs-set.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-share.8.html">zfs-share.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-snapshot.8.html">zfs-snapshot.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unallow.8.html">zfs-unallow.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unjail.8.html">zfs-unjail.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unload-key.8.html">zfs-unload-key.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unmount.8.html">zfs-unmount.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-unzone.8.html">zfs-unzone.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-upgrade.8.html">zfs-upgrade.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-userspace.8.html">zfs-userspace.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-wait.8.html">zfs-wait.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-zone.8.html">zfs-zone.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs.8.html">zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs_ids_to_path.8.html">zfs_ids_to_path.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs_prepare_disk.8.html">zfs_prepare_disk.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zgenhostid.8.html">zgenhostid.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zinject.8.html">zinject.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-add.8.html">zpool-add.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-attach.8.html">zpool-attach.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-checkpoint.8.html">zpool-checkpoint.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-clear.8.html">zpool-clear.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-create.8.html">zpool-create.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-ddtprune.8.html">zpool-ddtprune.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-destroy.8.html">zpool-destroy.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-detach.8.html">zpool-detach.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-events.8.html">zpool-events.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-export.8.html">zpool-export.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-get.8.html">zpool-get.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-history.8.html">zpool-history.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-import.8.html">zpool-import.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-initialize.8.html">zpool-initialize.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-iostat.8.html">zpool-iostat.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-labelclear.8.html">zpool-labelclear.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-list.8.html">zpool-list.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-offline.8.html">zpool-offline.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-online.8.html">zpool-online.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-prefetch.8.html">zpool-prefetch.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-reguid.8.html">zpool-reguid.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-remove.8.html">zpool-remove.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-reopen.8.html">zpool-reopen.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-replace.8.html">zpool-replace.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-resilver.8.html">zpool-resilver.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-scrub.8.html">zpool-scrub.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-set.8.html">zpool-set.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-split.8.html">zpool-split.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-status.8.html">zpool-status.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-sync.8.html">zpool-sync.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-trim.8.html">zpool-trim.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-upgrade.8.html">zpool-upgrade.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool-wait.8.html">zpool-wait.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool.8.html">zpool.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool_influxdb.8.html">zpool_influxdb.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zstream.8.html">zstream.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zstreamdump.8.html">zstreamdump.8</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.4/index.html">v2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.3/index.html">v2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.2/index.html">v2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.1/index.html">v2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.0/index.html">v2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v0.8/index.html">v0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v0.7/index.html">v0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v0.6/index.html">v0.6</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../msg/index.html">ZFS Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../License.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #29667e" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OpenZFS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Man Pages</a></li>
          <li class="breadcrumb-item"><a href="../index.html">master</a></li>
          <li class="breadcrumb-item"><a href="index.html">System Administration Commands (8)</a></li>
      <li class="breadcrumb-item active">zfs-program.8</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/openzfs/zfs/blob/master/man/man8/zfs-program.8" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="zfs-program-8">
<h1>zfs-program.8<a class="headerlink" href="#zfs-program-8" title="Permalink to this heading"></a></h1>
<div class="man_container"><table class="head">
  <tr>
    <td class="head-ltitle">ZFS-PROGRAM(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">ZFS-PROGRAM(8)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">zfs-program</code> &#x2014;
    <span class="Nd">execute ZFS channel programs</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">zfs</code></td>
    <td><code class="Cm">program</code> [<code class="Fl">-jn</code>]
      [<code class="Fl">-t</code> <var class="Ar">instruction-limit</var>]
      [<code class="Fl">-m</code> <var class="Ar">memory-limit</var>]
      <var class="Ar">pool</var> <var class="Ar">script</var>
      [<var class="Ar">script arguments</var>]</td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The ZFS channel program interface allows ZFS administrative
    operations to be run programmatically as a Lua script. The entire script is
    executed atomically, with no other administrative operations taking effect
    concurrently. A library of ZFS calls is made available to channel program
    scripts. Channel programs may only be run with root privileges.</p>
<p class="Pp">A modified version of the Lua 5.2 interpreter is used to run
    channel program scripts. The Lua 5.2 manual can be found at
    <a class="Lk" href="http://www.lua.org/manual/5.2/">http://www.lua.org/manual/5.2/</a></p>
<p class="Pp">The channel program given by <var class="Ar">script</var> will be
    run on <var class="Ar">pool</var>, and any attempts to access or modify
    other pools will cause an error.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt id="j"><a class="permalink" href="#j"><code class="Fl">-j</code></a>,
    <code class="Fl">--json</code></dt>
  <dd>Display channel program output in JSON format. When this flag is specified
      and standard output is empty - channel program encountered an error. The
      details of such an error will be printed to standard error in plain
    text.</dd>
  <dt id="n"><a class="permalink" href="#n"><code class="Fl">-n</code></a></dt>
  <dd>Executes a read-only channel program, which runs faster. The program
      cannot change on-disk state by calling functions from the zfs.sync
      submodule. The program can be used to gather information such as
      properties and determining if changes would succeed (zfs.check.*). Without
      this flag, all pending changes must be synced to disk before a channel
      program can complete.</dd>
  <dt id="t"><a class="permalink" href="#t"><code class="Fl">-t</code></a>
    <var class="Ar">instruction-limit</var></dt>
  <dd>Limit the number of Lua instructions to execute. If a channel program
      executes more than the specified number of instructions, it will be
      stopped and an error will be returned. The default limit is 10 million
      instructions, and it can be set to a maximum of 100 million
    instructions.</dd>
  <dt id="m"><a class="permalink" href="#m"><code class="Fl">-m</code></a>
    <var class="Ar">memory-limit</var></dt>
  <dd>Memory limit, in bytes. If a channel program attempts to allocate more
      memory than the given limit, it will be stopped and an error returned. The
      default memory limit is 10 MiB, and can be set to a maximum of 100
    MiB.</dd>
</dl>
<p class="Pp">All remaining argument strings will be passed directly to the Lua
    script as described in the <a class="Sx" href="#LUA_INTERFACE">LUA
    INTERFACE</a> section below.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="LUA_INTERFACE"><a class="permalink" href="#LUA_INTERFACE">LUA
  INTERFACE</a></h1>
<p class="Pp">A channel program can be invoked either from the command line, or
    via a library call to
    <a class="permalink" href="#lzc_channel_program"><code class="Fn" id="lzc_channel_program">lzc_channel_program</code></a>().</p>
<section class="Ss">
<h2 class="Ss" id="Arguments"><a class="permalink" href="#Arguments">Arguments</a></h2>
<p class="Pp">Arguments passed to the channel program are converted to a Lua
    table. If invoked from the command line, extra arguments to the Lua script
    will be accessible as an array stored in the argument table with the key
    'argv':</p>
<div class="Bd Bd-indent Li">
<pre>args = ...
argv = args[&quot;argv&quot;]
-- argv == {1=&quot;arg1&quot;, 2=&quot;arg2&quot;, ...}</pre>
</div>
<p class="Pp">If invoked from the libzfs interface, an arbitrary argument list
    can be passed to the channel program, which is accessible via the same
    &quot;<code class="Li">...</code>&quot; syntax in Lua:</p>
<div class="Bd Bd-indent Li">
<pre>args = ...
-- args == {&quot;foo&quot;=&quot;bar&quot;, &quot;baz&quot;={...}, ...}</pre>
</div>
<p class="Pp">Note that because Lua arrays are 1-indexed, arrays passed to Lua
    from the libzfs interface will have their indices incremented by 1. That is,
    the element in <var class="Va">arr[0]</var> in a C array passed to a channel
    program will be stored in <var class="Va">arr[1]</var> when accessed from
    Lua.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Return_Values"><a class="permalink" href="#Return_Values">Return
  Values</a></h2>
<p class="Pp">Lua return statements take the form:</p>
<div class="Bd Bd-indent"><code class="Li">return ret0, ret1, ret2,
  ...</code></div>
<p class="Pp">Return statements returning multiple values are permitted
    internally in a channel program script, but attempting to return more than
    one value from the top level of the channel program is not permitted and
    will throw an error. However, tables containing multiple values can still be
    returned. If invoked from the command line, a return statement:</p>
<div class="Bd Bd-indent Li">
<pre>a = {foo=&quot;bar&quot;, baz=2}
return a</pre>
</div>
<p class="Pp">Will be output formatted as:</p>
<div class="Bd Bd-indent Li">
<pre>Channel program fully executed with return value:
    return:
        baz: 2
        foo: 'bar'</pre>
</div>
</section>
<section class="Ss">
<h2 class="Ss" id="Fatal_Errors"><a class="permalink" href="#Fatal_Errors">Fatal
  Errors</a></h2>
<p class="Pp">If the channel program encounters a fatal error while running, a
    non-zero exit status will be returned. If more information about the error
    is available, a singleton list will be returned detailing the error:</p>
<div class="Bd Bd-indent"><code class="Li">error: &quot;error string, including
  Lua stack trace&quot;</code></div>
<p class="Pp">If a fatal error is returned, the channel program may have not
    executed at all, may have partially executed, or may have fully executed but
    failed to pass a return value back to userland.</p>
<p class="Pp">If the channel program exhausts an instruction or memory limit, a
    fatal error will be generated and the program will be stopped, leaving the
    program partially executed. No attempt is made to reverse or undo any
    operations already performed. Note that because both the instruction count
    and amount of memory used by a channel program are deterministic when run
    against the same inputs and filesystem state, as long as a channel program
    has run successfully once, you can guarantee that it will finish
    successfully against a similar size system.</p>
<p class="Pp">If a channel program attempts to return too large a value, the
    program will fully execute but exit with a nonzero status code and no return
    value.</p>
<p class="Pp" id="Note"><a class="permalink" href="#Note"><i class="Em">Note</i></a>:
    ZFS API functions do not generate Fatal Errors when correctly invoked, they
    return an error code and the channel program continues executing. See the
    <a class="Sx" href="#ZFS_API">ZFS API</a> section below for
    function-specific details on error return codes.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Lua_to_C_Value_Conversion"><a class="permalink" href="#Lua_to_C_Value_Conversion">Lua
  to C Value Conversion</a></h2>
<p class="Pp">When invoking a channel program via the libzfs interface, it is
    necessary to translate arguments and return values from Lua values to their
    C equivalents, and vice-versa.</p>
<p class="Pp">There is a correspondence between nvlist values in C and Lua
    tables. A Lua table which is returned from the channel program will be
    recursively converted to an nvlist, with table values converted to their
    natural equivalents:</p>
<table class="tbl">
  <tr>
    <td style="text-align: center;"></td>
    <td>string</td>
    <td style="text-align: center;">-&gt;</td>
    <td>string</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>number</td>
    <td style="text-align: center;">-&gt;</td>
    <td>int64</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>boolean</td>
    <td style="text-align: center;">-&gt;</td>
    <td>boolean_value</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>nil</td>
    <td style="text-align: center;">-&gt;</td>
    <td>boolean (no value)</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>table</td>
    <td style="text-align: center;">-&gt;</td>
    <td>nvlist</td>
  </tr>
</table>
<p class="Pp">Likewise, table keys are replaced by string equivalents as
    follows:</p>
<table class="tbl">
  <tr>
    <td style="text-align: center;"></td>
    <td>string</td>
    <td style="text-align: center;">-&gt;</td>
    <td>no change</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>number</td>
    <td style="text-align: center;">-&gt;</td>
    <td>signed decimal string (&quot;%lld&quot;)</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>boolean</td>
    <td style="text-align: center;">-&gt;</td>
    <td>&quot;true&quot; | &quot;false&quot;</td>
  </tr>
</table>
<p class="Pp">Any collision of table key strings (for example, the string
    &quot;true&quot; and a true boolean value) will cause a fatal error.</p>
<p class="Pp">Lua numbers are represented internally as signed 64-bit
  integers.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="LUA_STANDARD_LIBRARY"><a class="permalink" href="#LUA_STANDARD_LIBRARY">LUA
  STANDARD LIBRARY</a></h1>
<p class="Pp">The following Lua built-in base library functions are
  available:</p>
<table class="tbl">
  <tr>
    <td style="text-align: center;"></td>
    <td>assert</td>
    <td>rawlen</td>
    <td>collectgarbage</td>
    <td>rawget</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>error</td>
    <td>rawset</td>
    <td>getmetatable</td>
    <td>select</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>ipairs</td>
    <td>setmetatable</td>
    <td>next</td>
    <td>tonumber</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>pairs</td>
    <td>tostring</td>
    <td>rawequal</td>
    <td>type</td>
  </tr>
</table>
<p class="Pp" id="coroutine">All functions in the
    <a class="permalink" href="#coroutine"><i class="Em">coroutine</i></a>,
    <a class="permalink" href="#string"><i class="Em" id="string">string</i></a>,
    and
    <a class="permalink" href="#table"><i class="Em" id="table">table</i></a>
    built-in submodules are also available. A complete list and documentation of
    these modules is available in the Lua manual.</p>
<p class="Pp">The following functions base library functions have been disabled
    and are not available for use in channel programs:</p>
<table class="tbl">
  <tr>
    <td style="text-align: center;"></td>
    <td>dofile</td>
    <td>loadfile</td>
    <td>load</td>
    <td>pcall</td>
    <td>print</td>
    <td>xpcall</td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="ZFS_API"><a class="permalink" href="#ZFS_API">ZFS
  API</a></h1>
<section class="Ss">
<h2 class="Ss" id="Function_Arguments"><a class="permalink" href="#Function_Arguments">Function
  Arguments</a></h2>
<p class="Pp">Each API function takes a fixed set of required positional
    arguments and optional keyword arguments. For example, the destroy function
    takes a single positional string argument (the name of the dataset to
    destroy) and an optional &quot;defer&quot; keyword boolean argument. When
    using parentheses to specify the arguments to a Lua function, only
    positional arguments can be used:</p>
<div class="Bd
  Bd-indent"><code class="Li"><b class="Sy">zfs.sync.destroy</b>(&quot;rpool@snap&quot;)</code></div>
<p class="Pp">To use keyword arguments, functions must be called with a single
    argument that is a Lua table containing entries mapping integers to
    positional arguments and strings to keyword arguments:</p>
<div class="Bd
  Bd-indent"><code class="Li"><b class="Sy">zfs.sync.destroy</b>({1=&quot;rpool@snap&quot;,
  defer=true})</code></div>
<p class="Pp">The Lua language allows curly braces to be used in place of
    parenthesis as syntactic sugar for this calling convention:</p>
<div class="Bd
  Bd-indent"><code class="Li"><b class="Sy">zfs.sync.snapshot</b>{&quot;rpool@snap&quot;,
  defer=true}</code></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Function_Return_Values"><a class="permalink" href="#Function_Return_Values">Function
  Return Values</a></h2>
<p class="Pp">If an API function succeeds, it returns 0. If it fails, it returns
    an error code and the channel program continues executing. API functions do
    not generate Fatal Errors except in the case of an unrecoverable internal
    file system error.</p>
<p class="Pp">In addition to returning an error code, some functions also return
    extra details describing what caused the error. This extra description is
    given as a second return value, and will always be a Lua table, or Nil if no
    error details were returned. Different keys will exist in the error details
    table depending on the function and error case. Any such function may be
    called expecting a single return value:</p>
<div class="Bd Bd-indent"><code class="Li">errno =
  <b class="Sy">zfs.sync.promote</b>(dataset)</code></div>
<p class="Pp">Or, the error details can be retrieved:</p>
<div class="Bd Bd-indent Li">
<pre><span class="No">errno, details =</span> <b class="Sy">zfs.sync.promote</b>(dataset)
if (errno == EEXIST) then
    assert(details ~= Nil)
    list_of_conflicting_snapshots = details
end</pre>
</div>
<p class="Pp">The following global aliases for API function error return codes
    are defined for use in channel programs:</p>
<table class="tbl">
  <tr>
    <td style="text-align: center;"></td>
    <td>EPERM</td>
    <td>ECHILD</td>
    <td>ENODEV</td>
    <td>ENOSPC</td>
    <td>ENOENT</td>
    <td>EAGAIN</td>
    <td>ENOTDIR</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>ESPIPE</td>
    <td>ESRCH</td>
    <td>ENOMEM</td>
    <td>EISDIR</td>
    <td>EROFS</td>
    <td>EINTR</td>
    <td>EACCES</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>EINVAL</td>
    <td>EMLINK</td>
    <td>EIO</td>
    <td>EFAULT</td>
    <td>ENFILE</td>
    <td>EPIPE</td>
    <td>ENXIO</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>ENOTBLK</td>
    <td>EMFILE</td>
    <td>EDOM</td>
    <td>E2BIG</td>
    <td>EBUSY</td>
    <td>ENOTTY</td>
    <td>ERANGE</td>
  </tr>
  <tr>
    <td style="text-align: center;"></td>
    <td>ENOEXEC</td>
    <td>EEXIST</td>
    <td>ETXTBSY</td>
    <td>EDQUOT</td>
    <td>EBADF</td>
    <td>EXDEV</td>
    <td>EFBIG</td>
  </tr>
</table>
</section>
<section class="Ss">
<h2 class="Ss" id="API_Functions"><a class="permalink" href="#API_Functions">API
  Functions</a></h2>
<p class="Pp">For detailed descriptions of the exact behavior of any ZFS
    administrative operations, see the main <a href="../8/zfs.8.html" class="Xr">zfs(8)</a> manual
    page.</p>
<dl class="Bl-tag">
  <dt id="zfs.debug"><a class="permalink" href="#zfs.debug"><code class="Fn">zfs.debug</code></a>(<var class="Fa">msg</var>)</dt>
  <dd>Record a debug message in the zfs_dbgmsg log. A log of these messages can
      be printed via mdb's &quot;::zfs_dbgmsg&quot; command, or can be monitored
      live by running
    <div class="Bd Bd-indent"><code class="Li">dtrace -n
      'zfs-dbgmsg{trace(stringof(arg0))}'</code></div>
    <p class="Pp"></p>
    <dl class="Bl-tag Bl-compact">
      <dt><var class="Ar">msg</var> (string)</dt>
      <dd>Debug message to be printed.</dd>
    </dl>
  </dd>
  <dt id="zfs.exists"><a class="permalink" href="#zfs.exists"><code class="Fn">zfs.exists</code></a>(<var class="Fa">dataset</var>)</dt>
  <dd>Returns true if the given dataset exists, or false if it doesn't. A fatal
      error will be thrown if the dataset is not in the target pool. That is, in
      a channel program running on rpool,
      <b class="Sy">zfs.exists</b>(&quot;rpool/nonexistent_fs&quot;) returns
      false, but
      <b class="Sy">zfs.exists</b>(&quot;somepool/fs_that_may_exist&quot;) will
      error.
    <p class="Pp"></p>
    <dl class="Bl-tag Bl-compact">
      <dt><var class="Ar">dataset</var> (string)</dt>
      <dd>Dataset to check for existence. Must be in the target pool.</dd>
    </dl>
  </dd>
  <dt id="zfs.get_prop"><a class="permalink" href="#zfs.get_prop"><code class="Fn">zfs.get_prop</code></a>(<var class="Fa">dataset</var>,
    <var class="Fa">property</var>)</dt>
  <dd>Returns two values. First, a string, number or table containing the
      property value for the given dataset. Second, a string containing the
      source of the property (i.e. the name of the dataset in which it was set
      or nil if it is readonly). Throws a Lua error if the dataset is invalid or
      the property doesn't exist. Note that Lua only supports int64 number types
      whereas ZFS number properties are uint64. This means very large values
      (like GUIDs) may wrap around and appear negative.
    <p class="Pp"></p>
    <dl class="Bl-tag Bl-compact">
      <dt><var class="Ar">dataset</var> (string)</dt>
      <dd>Filesystem or snapshot path to retrieve properties from.</dd>
      <dt id="mounted"><var class="Ar">property</var> (string)</dt>
      <dd>Name of property to retrieve. All filesystem, snapshot and volume
          properties are supported except for
          <a class="permalink" href="#mounted"><b class="Sy">mounted</b></a> and
          <a class="permalink" href="#iscsioptions"><b class="Sy" id="iscsioptions">iscsioptions</b></a>.
          Also supports the
          <a class="permalink" href="#written@"><b class="Sy" id="written@">written@</b></a><var class="Ar">snap</var>
          and
          <a class="permalink" href="#written_"><b class="Sy" id="written_">written#</b></a><var class="Ar">bookmark</var>
          properties and the
          &#x27E8;<a class="permalink" href="#user"><b class="Sy" id="user">user</b></a>|<a class="permalink" href="#group"><b class="Sy" id="group">group</b></a>&#x27E9;&#x27E8;<a class="permalink" href="#quota"><b class="Sy" id="quota">quota</b></a>|<a class="permalink" href="#used"><b class="Sy" id="used">used</b></a>&#x27E9;<a class="permalink" href="#@"><b class="Sy" id="@">@</b></a><var class="Ar">id</var>
          properties, though the id must be in numeric form.</dd>
    </dl>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt id="zfs.sync"><a class="permalink" href="#zfs.sync"><b class="Sy">zfs.sync
    submodule</b></a></dt>
  <dd>The sync submodule contains functions that modify the on-disk state. They
      are executed in &quot;syncing context&quot;.
    <p class="Pp">The available sync submodule functions are as follows:</p>
    <dl class="Bl-tag">
      <dt id="zfs.sync.clone"><a class="permalink" href="#zfs.sync.clone"><code class="Fn">zfs.sync.clone</code></a>(<var class="Fa">snapshot</var>,
        <var class="Fa">newdataset</var>)</dt>
      <dd>Create a new filesystem from a snapshot. Returns 0 if the filesystem
          was successfully created, and a nonzero error code otherwise.
        <p class="Pp" id="none">Note: Due to general limitations in channel
            programs, a filesystem created this way will not be mounted,
            regardless of the value of the <b class="Sy">mountpoint</b> and
            <b class="Sy">canmount</b> properties. This limitation may be
            removed in the future, so it is recommended that you set
            <b class="Sy">mountpoint</b>=<a class="permalink" href="#none"><b class="Sy">none</b></a>
            or
            <b class="Sy">canmount</b>=<a class="permalink" href="#off"><b class="Sy" id="off">off</b></a>
            or
            <a class="permalink" href="#noauto"><b class="Sy" id="noauto">noauto</b></a>
            to avoid surprises.</p>
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">snapshot</var> (string)</dt>
          <dd>Name of the source snapshot to clone.</dd>
          <dt><var class="Ar">newdataset</var> (string)</dt>
          <dd>Name of the target dataset to create.</dd>
        </dl>
      </dd>
      <dt id="zfs.sync.destroy"><a class="permalink" href="#zfs.sync.destroy"><b class="Sy">zfs.sync.destroy</b></a>(<var class="Ar">dataset</var>,
        [<var class="Ar">defer</var>=<b class="Sy">true</b>|<b class="Sy">false</b>])</dt>
      <dd>Destroy the given dataset. Returns 0 on successful destroy, or a
          nonzero error code if the dataset could not be destroyed (for example,
          if the dataset has any active children or clones).
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Filesystem or snapshot to be destroyed.</dd>
          <dt>[<var class="Ar">defer</var> (boolean)]</dt>
          <dd>Valid only for destroying snapshots. If set to true, and the
              snapshot has holds or clones, allows the snapshot to be marked for
              deferred deletion rather than failing.</dd>
        </dl>
      </dd>
      <dt id="zfs.sync.inherit"><a class="permalink" href="#zfs.sync.inherit"><code class="Fn">zfs.sync.inherit</code></a>(<var class="Fa">dataset</var>,
        <var class="Fa">property</var>)</dt>
      <dd>Clears the specified property in the given dataset, causing it to be
          inherited from an ancestor, or restored to the default if no ancestor
          property is set. The <code class="Nm">zfs</code>
          <code class="Cm">inherit</code> <code class="Fl">-S</code> option has
          not been implemented. Returns 0 on success, or a nonzero error code if
          the property could not be cleared.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Filesystem or snapshot containing the property to clear.</dd>
          <dt><var class="Ar">property</var> (string)</dt>
          <dd>The property to clear. Allowed properties are the same as those
              for the <code class="Nm">zfs</code>
              <code class="Cm">inherit</code> command.</dd>
        </dl>
      </dd>
      <dt id="zfs.sync.promote"><a class="permalink" href="#zfs.sync.promote"><code class="Fn">zfs.sync.promote</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd>Promote the given clone to a filesystem. Returns 0 on successful
          promotion, or a nonzero error code otherwise. If EEXIST is returned,
          the second return value will be an array of the clone's snapshots
          whose names collide with snapshots of the parent filesystem.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Clone to be promoted.</dd>
        </dl>
      </dd>
      <dt id="zfs.sync.rollback"><a class="permalink" href="#zfs.sync.rollback"><code class="Fn">zfs.sync.rollback</code></a>(<var class="Fa">filesystem</var>)</dt>
      <dd>Rollback to the previous snapshot for a dataset. Returns 0 on
          successful rollback, or a nonzero error code otherwise. Rollbacks can
          be performed on filesystems or zvols, but not on snapshots or mounted
          datasets. EBUSY is returned in the case where the filesystem is
          mounted.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">filesystem</var> (string)</dt>
          <dd>Filesystem to rollback.</dd>
        </dl>
      </dd>
      <dt id="zfs.sync.set_prop"><a class="permalink" href="#zfs.sync.set_prop"><code class="Fn">zfs.sync.set_prop</code></a>(<var class="Fa">dataset</var>,
        <var class="Fa">property</var>, <var class="Fa">value</var>)</dt>
      <dd>Sets the given property on a dataset. Currently only user properties
          are supported. Returns 0 if the property was set, or a nonzero error
          code otherwise.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>The dataset where the property will be set.</dd>
          <dt><var class="Ar">property</var> (string)</dt>
          <dd>The property to set.</dd>
          <dt><var class="Ar">value</var> (string)</dt>
          <dd>The value of the property to be set.</dd>
        </dl>
      </dd>
      <dt id="zfs.sync.snapshot"><a class="permalink" href="#zfs.sync.snapshot"><code class="Fn">zfs.sync.snapshot</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd>Create a snapshot of a filesystem. Returns 0 if the snapshot was
          successfully created, and a nonzero error code otherwise.
        <p class="Pp">Note: Taking a snapshot will fail on any pool older than
            legacy version 27. To enable taking snapshots from ZCP scripts, the
            pool must be upgraded.</p>
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Name of snapshot to create.</dd>
        </dl>
      </dd>
      <dt id="zfs.sync.rename_snapshot"><a class="permalink" href="#zfs.sync.rename_snapshot"><code class="Fn">zfs.sync.rename_snapshot</code></a>(<var class="Fa">dataset</var>,
        <var class="Fa">oldsnapname</var>,
        <var class="Fa">newsnapname</var>)</dt>
      <dd>Rename a snapshot of a filesystem or a volume. Returns 0 if the
          snapshot was successfully renamed, and a nonzero error code otherwise.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Name of the snapshot's parent dataset.</dd>
          <dt><var class="Ar">oldsnapname</var> (string)</dt>
          <dd>Original name of the snapshot.</dd>
          <dt><var class="Ar">newsnapname</var> (string)</dt>
          <dd>New name of the snapshot.</dd>
        </dl>
      </dd>
      <dt id="zfs.sync.bookmark"><a class="permalink" href="#zfs.sync.bookmark"><code class="Fn">zfs.sync.bookmark</code></a>(<var class="Fa">source</var>,
        <var class="Fa">newbookmark</var>)</dt>
      <dd>Create a bookmark of an existing source snapshot or bookmark. Returns
          0 if the new bookmark was successfully created, and a nonzero error
          code otherwise.
        <p class="Pp">Note: Bookmarking requires the corresponding pool feature
            to be enabled.</p>
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">source</var> (string)</dt>
          <dd>Full name of the existing snapshot or bookmark.</dd>
          <dt><var class="Ar">newbookmark</var> (string)</dt>
          <dd>Full name of the new bookmark.</dd>
        </dl>
      </dd>
    </dl>
  </dd>
  <dt id="zfs.check"><a class="permalink" href="#zfs.check"><b class="Sy">zfs.check
    submodule</b></a></dt>
  <dd>For each function in the <b class="Sy">zfs.sync</b> submodule, there is a
      corresponding <b class="Sy">zfs.check</b> function which performs a
      &quot;dry run&quot; of the same operation. Each takes the same arguments
      as its <b class="Sy">zfs.sync</b> counterpart and returns 0 if the
      operation would succeed, or a non-zero error code if it would fail, along
      with any other error details. That is, each has the same behavior as the
      corresponding sync function except for actually executing the requested
      change. For example,
      <a class="permalink" href="#zfs.check.destroy"><code class="Fn" id="zfs.check.destroy">zfs.check.destroy</code></a>(<var class="Fa">&quot;fs&quot;</var>)
      returns 0 if
      <code class="Fn">zfs.sync.destroy</code>(<var class="Fa">&quot;fs&quot;</var>)
      would successfully destroy the dataset.
    <p class="Pp">The available <b class="Sy">zfs.check</b> functions are:</p>
    <dl class="Bl-tag Bl-compact">
      <dt id="zfs.check.clone"><a class="permalink" href="#zfs.check.clone"><code class="Fn">zfs.check.clone</code></a>(<var class="Fa">snapshot</var>,
        <var class="Fa">newdataset</var>)</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt id="zfs.check.destroy~2"><a class="permalink" href="#zfs.check.destroy~2"><b class="Sy">zfs.check.destroy</b></a>(<var class="Ar">dataset</var>,
        [<var class="Ar">defer</var>=<b class="Sy">true</b>|<b class="Sy">false</b>])</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt id="zfs.check.promote"><a class="permalink" href="#zfs.check.promote"><code class="Fn">zfs.check.promote</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt id="zfs.check.rollback"><a class="permalink" href="#zfs.check.rollback"><code class="Fn">zfs.check.rollback</code></a>(<var class="Fa">filesystem</var>)</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt id="zfs.check.set_property"><a class="permalink" href="#zfs.check.set_property"><code class="Fn">zfs.check.set_property</code></a>(<var class="Fa">dataset</var>,
        <var class="Fa">property</var>, <var class="Fa">value</var>)</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt id="zfs.check.snapshot"><a class="permalink" href="#zfs.check.snapshot"><code class="Fn">zfs.check.snapshot</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd style="width: auto;">&#x00A0;</dd>
    </dl>
  </dd>
  <dt id="zfs.list"><a class="permalink" href="#zfs.list"><b class="Sy">zfs.list
    submodule</b></a></dt>
  <dd>The zfs.list submodule provides functions for iterating over datasets and
      properties. Rather than returning tables, these functions act as Lua
      iterators, and are generally used as follows:
    <div class="Bd Bd-indent Li">
    <pre><span class="No">for child in</span> <code class="Fn">zfs.list.children</code>(<var class="Fa">&quot;rpool&quot;</var>) <span class="No">do</span>
    ...
end</pre>
    </div>
    <p class="Pp">The available <b class="Sy">zfs.list</b> functions are:</p>
    <dl class="Bl-tag">
      <dt id="zfs.list.clones"><a class="permalink" href="#zfs.list.clones"><code class="Fn">zfs.list.clones</code></a>(<var class="Fa">snapshot</var>)</dt>
      <dd>Iterate through all clones of the given snapshot.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">snapshot</var> (string)</dt>
          <dd>Must be a valid snapshot path in the current pool.</dd>
        </dl>
      </dd>
      <dt id="zfs.list.snapshots"><a class="permalink" href="#zfs.list.snapshots"><code class="Fn">zfs.list.snapshots</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd>Iterate through all snapshots of the given dataset. Each snapshot is
          returned as a string containing the full dataset name, e.g.
          &quot;pool/fs@snap&quot;.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Must be a valid filesystem or volume.</dd>
        </dl>
      </dd>
      <dt id="zfs.list.children"><a class="permalink" href="#zfs.list.children"><code class="Fn">zfs.list.children</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd>Iterate through all direct children of the given dataset. Each child
          is returned as a string containing the full dataset name, e.g.
          &quot;pool/fs/child&quot;.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Must be a valid filesystem or volume.</dd>
        </dl>
      </dd>
      <dt id="zfs.list.bookmarks"><a class="permalink" href="#zfs.list.bookmarks"><code class="Fn">zfs.list.bookmarks</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd>Iterate through all bookmarks of the given dataset. Each bookmark is
          returned as a string containing the full dataset name, e.g.
          &quot;pool/fs#bookmark&quot;.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Must be a valid filesystem or volume.</dd>
        </dl>
      </dd>
      <dt id="zfs.list.holds"><a class="permalink" href="#zfs.list.holds"><code class="Fn">zfs.list.holds</code></a>(<var class="Fa">snapshot</var>)</dt>
      <dd>Iterate through all user holds on the given snapshot. Each hold is
          returned as a pair of the hold's tag and the timestamp (in seconds
          since the epoch) at which it was created.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">snapshot</var> (string)</dt>
          <dd>Must be a valid snapshot.</dd>
        </dl>
      </dd>
      <dt id="zfs.list.properties"><a class="permalink" href="#zfs.list.properties"><code class="Fn">zfs.list.properties</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd>An alias for zfs.list.user_properties (see relevant entry).
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Must be a valid filesystem, snapshot, or volume.</dd>
        </dl>
      </dd>
      <dt id="zfs.list.user_properties"><a class="permalink" href="#zfs.list.user_properties"><code class="Fn">zfs.list.user_properties</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd>Iterate through all user properties for the given dataset. For each
          step of the iteration, output the property name, its value, and its
          source. Throws a Lua error if the dataset is invalid.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Must be a valid filesystem, snapshot, or volume.</dd>
        </dl>
      </dd>
      <dt id="zfs.list.system_properties"><a class="permalink" href="#zfs.list.system_properties"><code class="Fn">zfs.list.system_properties</code></a>(<var class="Fa">dataset</var>)</dt>
      <dd>Returns an array of strings, the names of the valid system (non-user
          defined) properties for the given dataset. Throws a Lua error if the
          dataset is invalid.
        <p class="Pp"></p>
        <dl class="Bl-tag Bl-compact">
          <dt><var class="Ar">dataset</var> (string)</dt>
          <dd>Must be a valid filesystem, snapshot or volume.</dd>
        </dl>
      </dd>
    </dl>
  </dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLES"><a class="permalink" href="#EXAMPLES">EXAMPLES</a></h1>
<section class="Ss">
<h2 class="Ss" id="Example_1"><a class="permalink" href="#Example_1">Example
  1</a></h2>
<p class="Pp">The following channel program recursively destroys a filesystem
    and all its snapshots and children in a naive manner. Note that this does
    not involve any error handling or reporting.</p>
<div class="Bd Pp Bd-indent Li">
<pre>function destroy_recursive(root)
    for child in zfs.list.children(root) do
        destroy_recursive(child)
    end
    for snap in zfs.list.snapshots(root) do
        zfs.sync.destroy(snap)
    end
    zfs.sync.destroy(root)
end
destroy_recursive(&quot;pool/somefs&quot;)</pre>
</div>
</section>
<section class="Ss">
<h2 class="Ss" id="Example_2"><a class="permalink" href="#Example_2">Example
  2</a></h2>
<p class="Pp">A more verbose and robust version of the same channel program,
    which properly detects and reports errors, and also takes the dataset to
    destroy as a command line argument, would be as follows:</p>
<div class="Bd Pp Bd-indent Li">
<pre>succeeded = {}
failed = {}

function destroy_recursive(root)
    for child in zfs.list.children(root) do
        destroy_recursive(child)
    end
    for snap in zfs.list.snapshots(root) do
        err = zfs.sync.destroy(snap)
        if (err ~= 0) then
            failed[snap] = err
        else
            succeeded[snap] = err
        end
    end
    err = zfs.sync.destroy(root)
    if (err ~= 0) then
        failed[root] = err
    else
        succeeded[root] = err
    end
end

args = ...
argv = args[&quot;argv&quot;]

destroy_recursive(argv[1])

results = {}
results[&quot;succeeded&quot;] = succeeded
results[&quot;failed&quot;] = failed
return results</pre>
</div>
</section>
<section class="Ss">
<h2 class="Ss" id="Example_3"><a class="permalink" href="#Example_3">Example
  3</a></h2>
<p class="Pp">The following function performs a forced promote operation by
    attempting to promote the given clone and destroying any conflicting
    snapshots.</p>
<div class="Bd Pp Bd-indent Li">
<pre>function force_promote(ds)
   errno, details = zfs.check.promote(ds)
   if (errno == EEXIST) then
       assert(details ~= Nil)
       for i, snap in ipairs(details) do
           zfs.sync.destroy(ds .. &quot;@&quot; .. snap)
       end
   elseif (errno ~= 0) then
       return errno
   end
   return zfs.sync.promote(ds)
end</pre>
</div>
</section>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">June 5, 2025</td>
    <td class="foot-os">Debian</td>
  </tr>
</table>
</div></section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="zfs-mount.8.html" class="btn btn-neutral float-left" title="zfs-mount.8" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="zfs-project.8.html" class="btn btn-neutral float-right" title="zfs-project.8" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, OpenZFS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>