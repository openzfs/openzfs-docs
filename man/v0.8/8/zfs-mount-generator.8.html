

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>zfs-mount-generator.8 &mdash; OpenZFS  documentation</title>
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/mandoc.css" type="text/css" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="zfs-program.8" href="zfs-program.8.html" />
    <link rel="prev" title="zed.8" href="zed.8.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #29667e" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/logo_main.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Getting%20Started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Project%20and%20Community/index.html">Project and Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Developer%20Resources/index.html">Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Performance%20and%20Tuning/index.html">Performance and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Basic%20Concepts/index.html">Basic Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Man Pages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../master/index.html">master</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.4/index.html">v2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.3/index.html">v2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.2/index.html">v2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.1/index.html">v2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v2.0/index.html">v2.0</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">v0.8</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../1/index.html">User Commands (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../5/index.html">File Formats and Conventions (5)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">System Administration Commands (8)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="fsck.zfs.8.html">fsck.zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="mount.zfs.8.html">mount.zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="vdev_id.8.html">vdev_id.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zdb.8.html">zdb.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zed.8.html">zed.8</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">zfs-mount-generator.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs-program.8.html">zfs-program.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfs.8.html">zfs.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zfsprops.8.html">zfsprops.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zgenhostid.8.html">zgenhostid.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zinject.8.html">zinject.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zpool.8.html">zpool.8</a></li>
<li class="toctree-l4"><a class="reference internal" href="zstreamdump.8.html">zstreamdump.8</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../v0.7/index.html">v0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v0.6/index.html">v0.6</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../msg/index.html">ZFS Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../License.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #29667e" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OpenZFS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Man Pages</a></li>
          <li class="breadcrumb-item"><a href="../index.html">v0.8</a></li>
          <li class="breadcrumb-item"><a href="index.html">System Administration Commands (8)</a></li>
      <li class="breadcrumb-item active">zfs-mount-generator.8</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/openzfs/zfs/blob/zfs-0.8.6/man/man8/zfs-mount-generator.8" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="zfs-mount-generator-8">
<h1>zfs-mount-generator.8<a class="headerlink" href="#zfs-mount-generator-8" title="Permalink to this heading">ÔÉÅ</a></h1>
<div class="man_container"><table class="head">
  <tr>
    <td class="head-ltitle">ZFS-MOUNT-GENERATOR(8)</td>
    <td class="head-vol">zfs-mount-generator</td>
    <td class="head-rtitle">ZFS-MOUNT-GENERATOR(8)</td>
  </tr>
</table>
<div class="manual-text">
<p class="Pp"></p>
<p class="Pp"></p>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">zfs-mount-generator - generates systemd mount units for ZFS</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><b>@systemdgeneratordir@/zfs-mount-generator</b></p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">zfs-mount-generator implements the <b>Generators Specification</b>
    of <b>systemd</b>(1), and is called during early boot to generate
    <b>systemd.mount</b>(5) units for automatically mounted datasets. Mount
    ordering and dependencies are created for all tracked pools (see below).</p>
<p class="Pp"></p>
<section class="Ss">
<h2 class="Ss" id="ENCRYPTION_KEYS"><a class="permalink" href="#ENCRYPTION_KEYS">ENCRYPTION
  KEYS</a></h2>
<p class="Pp">If the dataset is an encryption root, a service that loads the
    associated key (either from file or through a <b>systemd-ask-password</b>(1)
    prompt) will be created. This service <b>RequiresMountsFor</b> the path of
    the key (if file-based) and also copies the mount unit's <b>After</b>,
    <b>Before</b> and <b>Requires</b>. All mount units of encrypted datasets add
    the key-load service for their encryption root to their <b>Wants</b> and
    <b>After</b>. The service will not be <b>Want</b>ed or <b>Require</b>d by
    <b>local-fs.target</b> directly, and so will only be started manually or as
    a dependency of a started mount unit.</p>
<p class="Pp"></p>
</section>
<section class="Ss">
<h2 class="Ss" id="UNIT_ORDERING_AND_DEPENDENCIES"><a class="permalink" href="#UNIT_ORDERING_AND_DEPENDENCIES">UNIT
  ORDERING AND DEPENDENCIES</a></h2>
<p class="Pp">mount unit's <b>Before</b> -&gt; key-load service (if any) -&gt;
    mount unit -&gt; mount unit's <b>After</b></p>
<p class="Pp">It is worth nothing that when a mount unit is activated, it
    activates all available mount units for parent paths to its mountpoint, i.e.
    activating the mount unit for /tmp/foo/1/2/3 automatically activates all
    available mount units for /tmp, /tmp/foo, /tmp/foo/1, and /tmp/foo/1/2. This
    is true for any combination of mount units from any sources, not just
  ZFS.</p>
<p class="Pp"></p>
</section>
<section class="Ss">
<h2 class="Ss" id="CACHE_FILE"><a class="permalink" href="#CACHE_FILE">CACHE
  FILE</a></h2>
<p class="Pp">Because ZFS pools may not be available very early in the boot
    process, information on ZFS mountpoints must be stored separately. The
    output of the command</p>
<p class="Pp"></p>
<div class="Bd-indent">zfs list -H -o
  name,mountpoint,canmount,atime,relatime,devices,exec,readonly,setuid,nbmand,encroot,keylocation,org.openzfs.systemd:requires,org.openzfs.systemd:requires-mounts-for,org.openzfs.systemd:before,org.openzfs.systemd:after,org.openzfs.systemd:wanted-by,org.openzfs.systemd:required-by,org.openzfs.systemd:nofail,org.openzfs.systemd:ignore
<p class="Pp"></p>
</div>
<p class="Pp">for datasets that should be mounted by systemd, should be kept
    separate from the pool, at</p>
<p class="Pp"></p>
<div class="Bd-indent">@sysconfdir@/zfs/zfs-list.cache/<i>POOLNAME</i></div>
<p class="Pp">The cache file, if writeable, will be kept synchronized with the
    pool state by the ZEDLET</p>
<p class="Pp"></p>
<div class="Bd-indent">history_event-zfs-list-cacher.sh .</div>
</section>
<section class="Ss">
<h2 class="Ss" id="PROPERTIES"><a class="permalink" href="#PROPERTIES">PROPERTIES</a></h2>
<p class="Pp">The behavior of the generator script can be influenced by the
    following dataset properties:</p>
<p class="Pp"></p>
<dl class="Bl-tag">
  <dt id="canmount"><a class="permalink" href="#canmount"><b>canmount</b>=<b>on</b>|<b>off</b>|<b>noauto</b></a></dt>
  <dd>If a dataset has <b>mountpoint</b> set and <b>canmount</b> is not
      <b>off</b>, a mount unit will be generated. Additionally, if
      <b>canmount</b> is <b>on</b>, <b>local-fs.target</b> will gain a
      dependency on the mount unit.
    <p class="Pp">This behavior is equal to the <b>auto</b> and <b>noauto</b>
        legacy mount options, see <b>systemd.mount</b>(5).</p>
    <p class="Pp">Encryption roots always generate a key-load service, even for
        <b>canmount=off</b>.</p>
  </dd>
  <dt id="org.openzfs.systemd:requires"><a class="permalink" href="#org.openzfs.systemd:requires"><b>org.openzfs.systemd:requires-mounts-for</b>=<b><i>path</i>...</b></a></dt>
  <dd>Space-separated list of mountpoints to require to be mounted for this
      mount unit</dd>
  <dt id="org.openzfs.systemd:before"><a class="permalink" href="#org.openzfs.systemd:before"><b>org.openzfs.systemd:before</b>=<b><i>unit</i>...</b></a></dt>
  <dd>The mount unit and associated key-load service will be ordered before this
      space-separated list of units.</dd>
  <dt id="org.openzfs.systemd:after"><a class="permalink" href="#org.openzfs.systemd:after"><b>org.openzfs.systemd:after</b>=<b><i>unit</i>...</b></a></dt>
  <dd>The mount unit and associated key-load service will be ordered after this
      space-separated list of units.</dd>
  <dt id="org.openzfs.systemd:wanted"><a class="permalink" href="#org.openzfs.systemd:wanted"><b>org.openzfs.systemd:wanted-by</b>=<b><i>unit</i>...</b></a></dt>
  <dd>Space-separated list of units that will gain a <b>Wants</b> dependency on
      this mount unit. Setting this property implies <b>noauto</b>.</dd>
  <dt id="org.openzfs.systemd:required"><a class="permalink" href="#org.openzfs.systemd:required"><b>org.openzfs.systemd:required-by</b>=<b><i>unit</i>...</b></a></dt>
  <dd>Space-separated list of units that will gain a <b>Requires</b> dependency
      on this mount unit. Setting this property implies <b>noauto</b>.</dd>
  <dt id="org.openzfs.systemd:nofail"><a class="permalink" href="#org.openzfs.systemd:nofail"><b>org.openzfs.systemd:nofail</b>=<b>unset</b>|<b>on</b>|<b>off</b></a></dt>
  <dd>Toggles between a <b>Wants</b> and <b>Requires</b> type of dependency
      between the mount unit and <b>local-fs.target</b>, if <b>noauto</b> isn't
      set or implied.
    <p class="Pp"><b>on</b>: Mount will be <b>WantedBy</b> local-fs.target</p>
    <p class="Pp"><b>off</b>: Mount will be <b>Before</b> and <b>RequiredBy</b>
        local-fs.target</p>
    <p class="Pp"><b>unset</b>: Mount will be <b>Before</b> and <b>WantedBy</b>
        local-fs.target</p>
  </dd>
  <dt id="org.openzfs.systemd:ignore"><a class="permalink" href="#org.openzfs.systemd:ignore"><b>org.openzfs.systemd:ignore</b>=<b>on</b>|<b>off</b></a></dt>
  <dd>If set to <b>on</b>, do not generate a mount unit for this dataset.
    <p class="Pp"></p>
  </dd>
</dl>
<br/>
See also <b>systemd.mount</b>(5)
<p class="Pp"></p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLE"><a class="permalink" href="#EXAMPLE">EXAMPLE</a></h1>
<p class="Pp">To begin, enable tracking for the pool:</p>
<p class="Pp"></p>
<div class="Bd-indent">touch
  @sysconfdir@/zfs/zfs-list.cache/<i>POOLNAME</i></div>
<p class="Pp">Then, enable the tracking ZEDLET:</p>
<p class="Pp"></p>
<div class="Bd-indent">ln -s
  &quot;@zfsexecdir@/zed.d/history_event-zfs-list-cacher.sh&quot;
  &quot;@sysconfdir@/zfs/zed.d&quot;
<p class="Pp">systemctl enable zfs-zed.service</p>
<p class="Pp">systemctl restart zfs-zed.service</p>
</div>
<p class="Pp">Force the running of the ZEDLET by setting a monitored property,
    e.g. <b>canmount</b>, for at least one dataset in the pool:</p>
<p class="Pp"></p>
<div class="Bd-indent">zfs set canmount=on <i>DATASET</i></div>
<p class="Pp">This forces an update to the stale cache file.</p>
<p class="Pp">To test the generator output, run</p>
<p class="Pp"></p>
<div class="Bd-indent">@systemdgeneratordir@/zfs-mount-generator
  /tmp/zfs-mount-generator . .</div>
<p class="Pp">This will generate units and dependencies in
    <i>/tmp/zfs-mount-generator</i> for you to inspect them. The second and
    third argument are ignored.</p>
<p class="Pp">If you're satisfied with the generated units, instruct systemd to
    re-run all generators:</p>
<p class="Pp"></p>
<div class="Bd-indent">systemctl daemon-reload</div>
<p class="Pp"></p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><b>zfs</b>(5) <b>zfs-events</b>(5) <b>zed</b>(8) <b>zpool</b>(5)
    <b>systemd</b>(1) <b>systemd.target</b>(5) <b>systemd.special</b>(7)
    <b>systemd.mount</b>(7)</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-01-19</td>
    <td class="foot-os">ZFS</td>
  </tr>
</table>
</div></section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="zed.8.html" class="btn btn-neutral float-left" title="zed.8" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="zfs-program.8.html" class="btn btn-neutral float-right" title="zfs-program.8" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, OpenZFS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>